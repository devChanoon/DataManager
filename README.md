# DataManager

**DB 데이터 마이그레이션 프로그램**

DataManager는 데이터베이스 간의 데이터 마이그레이션을 효율적으로 수행할 수 있도록 돕는 프로그램입니다.

## 주요 구성 요소

본 프로그램은 다음과 같은 주요 구성 요소를 활용합니다.

* **DevExpress 22.2.3**: 사용자 인터페이스 및 다양한 기능을 제공하는 강력한 UI 컴포넌트 라이브러리입니다.
* **INI 파일**: 프로그램 설정 및 환경 설정을 관리하는 데 사용됩니다.

## 파일 구조

다음은 주요 파일 및 디렉토리 구조입니다.

### 설정 파일

* **경로**: `DataManager/bin/Debug/Init`
* **파일**: `DB_Config.ini`
* **설명**: 마지막으로 성공했던 DB 연결 정보를 저장합니다. 중요한 정보인 ID 및 비밀번호는 안전하게 암호화되어 저장됩니다.

### 로그 파일

* **경로**: `DataManager/bin/Debug/Log`
* **파일**: `Log.xml`
* **설명**: 프로그램의 작업 이력 및 각 작업의 결과를 상세하게 기록합니다. 이를 통해 오류 발생 시 추적 및 문제 해결에 용이합니다.

---

## 버전 히스토리

### v1.1.10 (2025-03-07)
* **오류 수정**: 유저 Role이 없는 유저에 대해 유저 생성 및 권한 복사가 제대로 되지 않던 오류가 수정되었습니다.

### v1.1.9 (2024-12-23)
* **오류 수정**: 특정 서버 기준 DB 백업 파일 복원 시 서버에 연결하지 못하던 오류가 수정되었습니다.

### v1.1.8 (2024-10-24)
* **기능 추가**: AllInOne 기능 실행 시 원본 DB의 사용자 권한을 복사하는 기능이 추가되었습니다.
* **기능 수정**: BackgroundWorker_Manager에서 Exception 발생 시 테이블 이름이 함께 표시되도록 수정되었습니다.

### v1.1.7 (2024-09-23)
* **오류 수정**: 프로그램 배포 시 신규 파일 경로가 추가되었을 경우, 해당 경로를 생성한 후 파일을 복사하도록 수정되었습니다.

### v1.1.6 (2024-06-19)
* **기능 수정**: 배포 파일 교체 시 기존 Web.config 파일에 URL 재작성 내용이 포함되어 있다면, 파일 복사 후 이전 URL 재작성 내용을 그대로 저장하도록 수정되었습니다.

### v1.1.5 (2024-06-14)
* **오류 수정**: DB 백업 파일이 Sql Server 서비스 계정이 접근할 수 없는 위치에 있을 경우 복원이 불가능하던 오류가 수정되었습니다. 백업 파일을 `C:\Users\Public\Documents` 폴더에 복사하여 해당 위치 기준으로 파일에 접근하도록 수정되었습니다.

### v1.1.4 (2024-05-31)
* **오류 수정**: 복사 대상 경로가 실제 압축 해제된 경로와 다를 경우 처리가 안 되던 오류가 수정되었습니다. 대상 경로 내 하위 폴더를 포함하여 실제 압축 해제된 경로를 찾도록 수정되었습니다.

### v1.1.3 (2024-05-24)
* **기능 수정**: 데이터 이전 프로세스가 변경되었습니다. DataRow가 너무 많을 경우 Memory Exception이 발생하는 문제를 해결하기 위해 1,000,000 Row 기준으로 조회 및 Bulk Copy를 반복하도록 수정되었습니다.
* Jenkins에서 생성된 `.tar` 파일 압축 해제 이슈로 SharpZipLib 라이브러리가 삭제되고 PowerShell을 사용하여 압축 및 압축 해제를 수행하도록 변경되었습니다.

### v1.1.2 (2024-05-23)
* **기능 추가**: All In One`.tar` 압축 파일 처리 기능이 추가되었습니다.

### v1.1.1 (2024-05-22)
* **기능 추가**:
    * All In One DB 작업 실패 시 백업 DB를 원본 DB로 변경하고 임시 DB를 삭제하는 기능이 추가되었습니다.
    * Thread 수 설정 기능이 추가되었습니다 (Copy Data 탭과 동일).
* **기능 수정**:
    * All In One 데이터 입력 방식이 변경되었습니다 (기존: 25 Row / 직접 Insert -> 수정: 10,000 Row / SqlBulkCopy).
    * 데이터 이전 프로세스가 변경되었습니다 (기존: 개별 테이블 복사 -> 모든 작업 완료 후 전체 테이블 순차적 검증 -> 수정: 개별 테이블 복사 -> 개별 테이블 검증 -> 이후 단계 진행).
* **매뉴얼 개정**.

### v1.1.0 (2024-05-20)
* **기능 추가**:
    * All In One 탭이 추가되었습니다. IIS 사이트 기준 배포 파일 교체 및 DB 데이터 이전 작업을 일괄 실행할 수 있습니다.
    * Log 기능이 추가되었습니다. 작업 이력 및 결과를 확인할 수 있습니다.
    * 패치 프로그램이 추가되었습니다. DB에 존재하는 최신 버전과 현재 적용 중인 버전을 비교하여 파일 업데이트를 진행합니다.
    * 파일 관리자 프로그램이 추가되었습니다. 버전별 파일 관리 및 패치 대상 파일 설정을 할 수 있습니다.
* **매뉴얼 개정**.

### v1.0.6 (2024-02-21)
* **오류 수정**: '#시간' 접미사가 포함된 Audittrail DB도 DB 리스트에 표시되도록 수정되었습니다.

### v1.0.5 (2023-12-11)
* **실행 권한 변경**: 애플리케이션이 관리자 권한으로 실행되도록 수정되었습니다.

### v1.0.4 (2023-12-04)
* **기능 추가**: 연결 중인 DB를 백업 DB로 전환하는 기능이 추가되었습니다 (#데이터베이스 이름 변경 쿼리의 동작을 프로그램에서 실행).
* **매뉴얼 갱신**: V1.0.3, V1.0.4 내용이 추가되었습니다.

### v1.0.3 (2023-09-14)
* **기능 추가**: 테이블 목록에서 테이블 이름을 검색하는 기능이 추가되었습니다.
* **기능 수정**: 테이블 데이터 insert 기준이 변경되었습니다 (기존: 24행 -> 수정: 25행).
* **매뉴얼 추가**: `_Ref/DB_Sync 매뉴얼.xlsx`, `#데이터베이스 이름 변경 쿼리.sql` 파일이 추가되었습니다.

### v1.0.2 (2023-07-17)
* **Process 수정**: 작업 진행 순서가 다음과 같이 변경되었습니다.
    1. 모든 FK 비활성화
    2. Thread > 테이블 존재 여부 확인
    3. Thread > 타겟 테이블 SET IDENTITY_INSERT ON
    4. Thread > 타겟 테이블 데이터 삭제
    5. Thread > 원본 테이블 데이터 조회
    6. Thread > 원본 -> 타겟 테이블 데이터 복사
    7. Thread > 타겟 테이블 SET IDENTITY_INSERT OFF
    8. Thread > 타겟 테이블 IDENTITY 재설정
    9. 모든 Thread 작업 완료 시까지 대기
    10. 모든 FK 활성화

### v1.0.1 (2023-07-17)
* **기능 수정**: 데이터 복사 및 검증 시 원본 테이블과 대상 테이블에 공통적으로 존재하는 컬럼에 대해서만 복사 및 검증을 진행하도록 수정되었습니다.
* FK 비활성화 시 테이블 존재 유무와 상관없이 모든 FK를 비활성화하도록 수정되었습니다.

### v1.0.0 (2023-07-10)
* **DB Information**: DB 주소, DB 이름, ID, 비밀번호를 입력하여 데이터를 복사할 DB에 접속합니다.
* **Action**: 원본 DB를 선택한 후 데이터를 복사할 테이블을 모두 선택하고 Execute 버튼을 클릭하면 데이터 복사가 진행됩니다.
* **Process**: 작업은 다음과 같은 순서로 진행됩니다.
    1. 모든 FK 비활성화
    2. Thread > 테이블 존재 여부 확인
    3. Thread > 타겟 테이블 SET IDENTITY_INSERT ON
    4. Thread > 타겟 테이블 데이터 삭제
    5. Thread > 원본 테이블 데이터 조회
    6. Thread > 원본 -> 타겟 테이블 데이터 복사
    7. Thread > 타겟 테이블 SET IDENTITY_INSERT OFF
    8. 모든 Thread 작업 완료 시까지 대기
    9. 모든 FK 활성화
